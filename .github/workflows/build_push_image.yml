name: Build and Push Docker Image

# Event trigger: Akan dijalankan saat ada push ke branch karsajobs-docker-hub
on:
  push:
    branches:
      - karsajobs-docker-hub

# Job untuk melakukan build dan push Docker image
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Langkah pertama: Checkout kode dari repositori
      - name: Checkout code
        uses: actions/checkout@v2

      # Langkah kedua: Menjalankan skrip build_push_image_karsajobs.sh
      - name: Build and Push Docker Image
        run: |
          # Mengubah izin skrip menjadi eksekusi
          chmod +x build_push_image_karsajobs.sh
          # Menjalankan skrip build_push_image_karsajobs.sh
          ./build_push_image_karsajobs.sh
        working-directory: ${{ github.workspace }}

      # Langkah ketiga: Login ke Docker Hub menggunakan informasi rahasia
      - name: Log in to Docker Hub
        run: echo "${{ secrets.DOCKERHUB_TOKEN }}" | docker login -u ${{ secrets.DOCKERHUB_USERNAME }} --password-stdin

      # Langkah keempat: Melakukan push Docker image ke Docker Hub
      - name: Push Docker Image to Docker Hub
        run: docker push ${{ secrets.DOCKERHUB_USERNAME }}/karsajobs:latest
        working-directory: ${{ github.workspace }}
